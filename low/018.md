seeu

low

# Avoid using abi.encodePacked() with dynamic types when passing the result to a hash function

## Summary

Avoid using `abi.encodePacked()` with dynamic types when passing the result to a hash function

## Vulnerability Detail

`abi.encode()` will pad items to 32 bytes, which will prevent [hash collisions](https://docs.soliditylang.org/en/v0.8.13/abi-spec.html#non-standard-packed-mode). `bytes.concat()` should be used if all parameters are strings or bytes.

## Impact

Prevention of hash collision

## Code Snippet

- [op-geth/contracts/checkpointoracle/contract/oracle.sol#L99](https://github.com/sherlock-audit/2023-01-optimism-seeu-inspace/tree/main/op-geth/contracts/checkpointoracle/contract/oracle.sol#L99)
  ```Solidity
  bytes32 signedHash = keccak256(abi.encodePacked(byte(0x19), byte(0), this, _sectionIndex, _hash));
  ```
- [optimism/integration-tests/contracts/TestOOG.sol#L8](https://github.com/sherlock-audit/2023-01-optimism-seeu-inspace/tree/main/optimism/integration-tests/contracts/TestOOG.sol#L8)
  ```Solidity
  h = keccak256(abi.encodePacked(h));
  ```
- [optimism/l2geth/contracts/checkpointoracle/contract/oracle.sol#L99](https://github.com/sherlock-audit/2023-01-optimism-seeu-inspace/tree/main/optimism/l2geth/contracts/checkpointoracle/contract/oracle.sol#L99)
  ```Solidity
  bytes32 signedHash = keccak256(abi.encodePacked(byte(0x19), byte(0), this, _sectionIndex, _hash));
  ```
- [optimism/packages/contracts/contracts/L1/messaging/L1CrossDomainMessenger.sol#L221](https://github.com/sherlock-audit/2023-01-optimism-seeu-inspace/tree/main/optimism/packages/contracts/contracts/L1/messaging/L1CrossDomainMessenger.sol#L221)
  ```Solidity
  bytes32 relayId = keccak256(abi.encodePacked(xDomainCalldata, msg.sender, block.number));
  ```
- [optimism/packages/contracts/contracts/L2/messaging/L2CrossDomainMessenger.sol#L152](https://github.com/sherlock-audit/2023-01-optimism-seeu-inspace/tree/main/optimism/packages/contracts/contracts/L2/messaging/L2CrossDomainMessenger.sol#L152)
  ```Solidity
  bytes32 relayId = keccak256(abi.encodePacked(xDomainCalldata, msg.sender, block.number));
  ```
- [optimism/packages/contracts/contracts/L2/predeploys/OVM_L2ToL1MessagePasser.sol#L33](https://github.com/sherlock-audit/2023-01-optimism-seeu-inspace/tree/main/optimism/packages/contracts/contracts/L2/predeploys/OVM_L2ToL1MessagePasser.sol#L33)
  ```Solidity
  sentMessages[keccak256(abi.encodePacked(_message, msg.sender))] = true;
  ```
- [optimism/packages/contracts/contracts/libraries/resolver/Lib_AddressManager.sol#L59](https://github.com/sherlock-audit/2023-01-optimism-seeu-inspace/tree/main/optimism/packages/contracts/contracts/libraries/resolver/Lib_AddressManager.sol#L59)
  ```Solidity
  return keccak256(abi.encodePacked(_name));
  ```
- [optimism/packages/contracts/contracts/libraries/trie/Lib_SecureMerkleTrie.sol#L64](https://github.com/sherlock-audit/2023-01-optimism-seeu-inspace/tree/main/optimism/packages/contracts/contracts/libraries/trie/Lib_SecureMerkleTrie.sol#L64)
  ```Solidity
  return abi.encodePacked(keccak256(_key));
  ```
- [optimism/packages/contracts/contracts/libraries/utils/Lib_MerkleTree.sol#L130](https://github.com/sherlock-audit/2023-01-optimism-seeu-inspace/tree/main/optimism/packages/contracts/contracts/libraries/utils/Lib_MerkleTree.sol#L130)
  ```Solidity
  computedRoot = keccak256(abi.encodePacked(_siblings[i], computedRoot));
  ```
- [optimism/packages/contracts/contracts/libraries/utils/Lib_MerkleTree.sol#L132](https://github.com/sherlock-audit/2023-01-optimism-seeu-inspace/tree/main/optimism/packages/contracts/contracts/libraries/utils/Lib_MerkleTree.sol#L132)
  ```Solidity
  computedRoot = keccak256(abi.encodePacked(computedRoot, _siblings[i]));
  ```
- [optimism/packages/contracts-bedrock/contracts/deployment/SystemDictator.sol#L313](https://github.com/sherlock-audit/2023-01-optimism-seeu-inspace/tree/main/optimism/packages/contracts-bedrock/contracts/deployment/SystemDictator.sol#L313)
  ```Solidity
  keccak256(abi.encodePacked(reason)) ==
  ```
- [optimism/packages/contracts-bedrock/contracts/legacy/AddressManager.sol#L62](https://github.com/sherlock-audit/2023-01-optimism-seeu-inspace/tree/main/optimism/packages/contracts-bedrock/contracts/legacy/AddressManager.sol#L62)
  ```Solidity
  return keccak256(abi.encodePacked(_name));
  ```
- [optimism/packages/contracts-bedrock/contracts/legacy/LegacyMessagePasser.sol#L31](https://github.com/sherlock-audit/2023-01-optimism-seeu-inspace/tree/main/optimism/packages/contracts-bedrock/contracts/legacy/LegacyMessagePasser.sol#L31)
  ```Solidity
  sentMessages[keccak256(abi.encodePacked(_message, msg.sender))] = true;
  ```
- [optimism/packages/contracts-bedrock/contracts/libraries/trie/MerkleTrie.sol#L116](https://github.com/sherlock-audit/2023-01-optimism-seeu-inspace/tree/main/optimism/packages/contracts-bedrock/contracts/libraries/trie/MerkleTrie.sol#L116)
  ```Solidity
  Bytes.equal(abi.encodePacked(keccak256(currentNode.encoded)), currentNodeID),
  ```
- [optimism/packages/contracts-bedrock/contracts/libraries/trie/MerkleTrie.sol#L122](https://github.com/sherlock-audit/2023-01-optimism-seeu-inspace/tree/main/optimism/packages/contracts-bedrock/contracts/libraries/trie/MerkleTrie.sol#L122)
  ```Solidity
  Bytes.equal(abi.encodePacked(keccak256(currentNode.encoded)), currentNodeID),
  ```
- [optimism/packages/contracts-bedrock/contracts/libraries/trie/SecureMerkleTrie.sol#L62](https://github.com/sherlock-audit/2023-01-optimism-seeu-inspace/tree/main/optimism/packages/contracts-bedrock/contracts/libraries/trie/SecureMerkleTrie.sol#L62)
  ```Solidity
  return abi.encodePacked(keccak256(_key));
  ```
- [optimism/packages/contracts-bedrock/contracts/test/LegacyMessagePasser.t.sol#L18](https://github.com/sherlock-audit/2023-01-optimism-seeu-inspace/tree/main/optimism/packages/contracts-bedrock/contracts/test/LegacyMessagePasser.t.sol#L18)
  ```Solidity
  assert(messagePasser.sentMessages(keccak256(abi.encodePacked(hex"ff", alice))));
  ```
- [optimism/packages/contracts-bedrock/contracts/test/MerkleTrie.t.sol#L324](https://github.com/sherlock-audit/2023-01-optimism-seeu-inspace/tree/main/optimism/packages/contracts-bedrock/contracts/test/MerkleTrie.t.sol#L324)
  ```Solidity
  bytes32 rootHash = keccak256(abi.encodePacked(root));
  ```
- [optimism/packages/contracts-bedrock/contracts/test/RLP.t.sol#L18](https://github.com/sherlock-audit/2023-01-optimism-seeu-inspace/tree/main/optimism/packages/contracts-bedrock/contracts/test/RLP.t.sol#L18)
  ```Solidity
  keccak256(abi.encodePacked(bytes1(0xd6), bytes1(0x94), deployer, bytes1(0x80)))
  ```
- [optimism/packages/contracts-bedrock/contracts/test/RLP.t.sol#L22](https://github.com/sherlock-audit/2023-01-optimism-seeu-inspace/tree/main/optimism/packages/contracts-bedrock/contracts/test/RLP.t.sol#L22)
  ```Solidity
  keccak256(abi.encodePacked(bytes1(0xd6), bytes1(0x94), deployer, uint8(nonce)))
  ```

## Tool used

- Private self-made tool for static analysis
- Manual Review, Remix IDE

## Recommendation

Instead of using `abi.encodePacked()` use `abi.encode()`. It will pad items to 32 bytes, which will prevent [hash collisions](https://docs.soliditylang.org/en/v0.8.13/abi-spec.html#non-standard-packed-mode).

It is possible to cast to `bytes()` or `bytes32()` in place of `abi.encodePacked()` when there is just one parameter, see "[how to compare strings in solidity?](https://ethereum.stackexchange.com/questions/30912/how-to-compare-strings-in-solidity#answer-82739)". `bytes.concat()` should be used if all parameters are strings or bytes.