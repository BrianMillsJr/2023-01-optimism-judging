seeu

high

# ERC165Checker may revert instead of returning false

## Summary

ERC165Checker may revert instead of returning false in the contract [L2StandardBridge.sol](https://github.com/sherlock-audit/2023-01-optimism/blob/main/optimism/packages/contracts/contracts/L2/messaging/L2StandardBridge.sol) because of an outdated version of `@openzeppelin/contracts` containing several vulnerabilities.

## Vulnerability Detail

In [optimism/packages/contracts/package.json#L76](https://github.com/sherlock-audit/2023-01-optimism/blob/main/optimism/packages/contracts/package.json#L76) it was found the outdated version `4.3.2` of `@openzeppelin/contracts`, then imported by multiple contracts and from [L2StandardBridge.sol](https://github.com/sherlock-audit/2023-01-optimism/blob/main/optimism/packages/contracts/contracts/L2/messaging/L2StandardBridge.sol). In the contract, `ERC165Checker.supportsInterface` may revert instead of returning a boolean.

## Impact

The contract [L2StandardBridge.sol](https://github.com/sherlock-audit/2023-01-optimism/blob/main/optimism/packages/contracts/contracts/L2/messaging/L2StandardBridge.sol) is affected by the following issue: 
> "`ERC165Checker.supportsInterface` is designed to always successfully return a boolean, and under no circumstance revert. However, an incorrect assumption about Solidity 0.8's `abi.decode` allows some cases to revert, given a target contract that doesn't implement EIP-165 as expected, specifically if it returns a value other than 0 or 1.<br/>The contracts that may be affected are those that use `ERC165Checker` to check for support for an interface and then handle the lack of support in a way other than reverting. [[Source](https://github.com/OpenZeppelin/openzeppelin-contracts/security/advisories/GHSA-qh9x-gcfh-pcrw)] [[CVE-2022-31170](https://nvd.nist.gov/vuln/detail/CVE-2022-31170)]"

## Code Snippet

The outdated version of `@openzeppelin/contracts` is the following: [optimism/packages/contracts/package.json#L76](https://github.com/sherlock-audit/2023-01-optimism/blob/main/optimism/packages/contracts/package.json#L76)
```json
"@openzeppelin/contracts": "4.3.2"
```

The contract [L2StandardBridge.sol](https://github.com/sherlock-audit/2023-01-optimism/blob/main/optimism/packages/contracts/contracts/L2/messaging/L2StandardBridge.sol) imports the outdated `@openzeppelin/contracts` from [optimism/packages/contracts/contracts/standards/IL2StandardERC20.sol#L4-L5](https://github.com/sherlock-audit/2023-01-optimism-seeu-inspace/tree/main/optimism/packages/contracts/contracts/standards/IL2StandardERC20.sol#L4-L5):
```Solidity
import { IERC20 } from "@openzeppelin/contracts/token/ERC20/IERC20.sol";
import { IERC165 } from "@openzeppelin/contracts/utils/introspection/IERC165.sol";
```

As you can see here: [optimism/packages/contracts/contracts/L2/messaging/L2StandardBridge.sol#L15](https://github.com/sherlock-audit/2023-01-optimism/blob/main/optimism/packages/contracts/contracts/L2/messaging/L2StandardBridge.sol#L15)
```Solidity
import { IL2StandardERC20 } from "../../standards/IL2StandardERC20.sol";
```

The code affected by this problematic is the following:
[optimism/packages/contracts/contracts/L2/messaging/L2StandardBridge.sol#L153](https://github.com/sherlock-audit/2023-01-optimism/blob/main/optimism/packages/contracts/contracts/L2/messaging/L2StandardBridge.sol#L153)
```Solidity
ERC165Checker.supportsInterface(_l2Token, 0x1d1d8b63) &&
```

It is also worth noting that the pragma solidity version of [L2StandardBridge.sol](https://github.com/sherlock-audit/2023-01-optimism/blob/main/optimism/packages/contracts/contracts/L2/messaging/L2StandardBridge.sol#L2) is `0.8.9` since this issue is specific for the Solidity versions `0.8's`:
```Solidity
pragma solidity ^0.8.9;
```


## Tool used

Manual Review

## Recommendation

It is highly suggested to update `@openzeppelin/contracts` to the [most recent version, `4.8.1`](https://www.npmjs.com/package/@openzeppelin/contracts), or at least to the version `4.7.1` since the issue highlighted is patched from this version.

Consider also that `@openzeppelin/contracts`'s version contains other multiple high severity vulnerabilities. See more here:

- [@openzeppelin/contracts vulnerabilities | Snyk](https://security.snyk.io/package/npm/@openzeppelin%2Fcontracts)
- [OpenZeppelin/openzeppelin-contracts/security/advisories](https://github.com/OpenZeppelin/openzeppelin-contracts/security/advisories)